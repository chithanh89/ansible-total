---
# tasks file for mongodb
- name: Add the admin user to the replicaset
  mongodb_user: database=admin name=admin password={{ mongo_admin_pass }} login_port={{ mongodb_port }} roles='root' state=present
  ignore_errors: yes

- name: Create the file to initialize the replicaset
  template: src=repset_init.js.j2 dest=/tmp/repset_init.js

- name: Initialize the replication set on the primary
  shell: /usr/bin/mongo -u admin -p {{ mongo_admin_pass }} --authenticationDatabase admin /tmp/repset_init.js
  run_once: true
